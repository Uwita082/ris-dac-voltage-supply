#include "pico/stdlib.h"
#include "hardware/spi.h"

#define SPI_PORT spi0
#define PIN_SCK 2
#define PIN_MOSI 3
#define PIN_MISO 4
#define PIN_CS 5

// Commands array similar to your Python code
const uint8_t commands[][16] = {
    {0x72, 0xFF, 0xFF, 0x00, 0x72, 0xFF, 0xFF, 0x00, 0x72, 0xFF, 0xFF, 0x00, 0x72, 0xFF, 0xFF, 0x00},
    {0x78, 0x80, 0x00, 0x00, 0x78, 0x80, 0x00, 0x00, 0x78, 0x80, 0x00, 0x00, 0x78, 0x80, 0x00, 0x00},
    {0x7C, 0x00, 0x00, 0x00, 0x7C, 0x00, 0x00, 0x00, 0x7C, 0x00, 0x00, 0x00, 0x7C, 0x00, 0x00, 0x00},
    {0x72, 0x00, 0x00, 0x00, 0x72, 0x00, 0x00, 0x00, 0x72, 0x00, 0x00, 0x00, 0x72, 0x00, 0x00, 0x00},
    {0x7B, 0x00, 0x14, 0x00, 0x7B, 0x00, 0x14, 0x00, 0x7B, 0x00, 0x14, 0x00, 0x7B, 0x00, 0x14, 0x00},
    // {0x74, 0xFF, 0xFF, 0x00, 0x74, 0xFF, 0xFF, 0x00, 0x74, 0xFF, 0xFF, 0x00, 0x74, 0xFF, 0xFF, 0x00}
};

// Additional commands
const uint8_t command1[16][16] = {
    {0x40, 0xFF, 0xF0, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00},
    {0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00},
    {0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00},
    {0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00},
    {0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00},
    {0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00},
    {0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00},
    {0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00},
    {0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00},
    {0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00},
    {0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00},
    {0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00},
    {0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00},
    {0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00},
    {0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00},
    {0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00},
};
const uint8_t command2[16][16] = {
    {0x40, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00},
    {0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00},
    {0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00},
    {0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00},
    {0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00},
    {0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00},
    {0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00},
    {0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00},
    {0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00},
    {0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00},
    {0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00},
    {0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00},
    {0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00},
    {0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00},
    {0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00},
    {0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00},
};

const uint8_t commands1[16] = {0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x40, 0xFF, 0xF0, 0x00};
const uint8_t commands2[16] = {0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00};

void send_command(const uint8_t* data, size_t length) {
    gpio_put(PIN_CS, 0);
    spi_write_blocking(SPI_PORT, data, length);
    gpio_put(PIN_CS, 1);
}

int main() {
    stdio_init_all();

    // Initialize SPI
    spi_init(SPI_PORT, 25 * 1000 * 1000); // 45 MHz
    spi_set_format(SPI_PORT, 8, SPI_CPOL_0, SPI_CPHA_0, SPI_MSB_FIRST);

    gpio_set_function(PIN_SCK, GPIO_FUNC_SPI);
    gpio_set_function(PIN_MOSI, GPIO_FUNC_SPI);
    gpio_set_function(PIN_MISO, GPIO_FUNC_SPI);

    // Initialize CS
    gpio_init(PIN_CS);
    gpio_set_dir(PIN_CS, GPIO_OUT);
    gpio_put(PIN_CS, 1); // CS high
    
    for (int i = 0; i < sizeof(commands) / sizeof(commands[0]); i++) {
        send_command(commands[i], sizeof(commands[i]));
    }

    // Test for best case - one instruction
    // while (true) {
    //     send_command(commands1, sizeof(commands1));
    //     sleep_us(12);
    //     send_command(commands2, sizeof(commands2));
    //     sleep_us(12);
    // }

    // Test for worse case - all instructions
    while (true) {
        send_command(command1[0], sizeof(command1[0]));
        send_command(command1[1], sizeof(command1[1]));
        send_command(command1[2], sizeof(command1[2]));
        send_command(command1[3], sizeof(command1[3]));
        send_command(command1[4], sizeof(command1[4]));
        send_command(command1[5], sizeof(command1[5]));
        send_command(command1[6], sizeof(command1[6]));
        send_command(command1[7], sizeof(command1[7]));
        send_command(command1[8], sizeof(command1[8]));
        send_command(command1[9], sizeof(command1[9]));
        send_command(command1[10], sizeof(command1[10]));
        send_command(command1[11], sizeof(command1[11]));
        send_command(command1[12], sizeof(command1[12]));
        send_command(command1[13], sizeof(command1[13]));
        send_command(command1[14], sizeof(command1[14]));
        send_command(command1[15], sizeof(command1[15]));
        send_command(command2[0], sizeof(command2[0]));
        send_command(command2[1], sizeof(command2[1]));
        send_command(command2[2], sizeof(command2[2]));
        send_command(command2[3], sizeof(command2[3]));
        send_command(command2[4], sizeof(command2[4]));
        send_command(command2[5], sizeof(command2[5]));
        send_command(command2[6], sizeof(command2[6]));
        send_command(command2[7], sizeof(command2[7]));
        send_command(command2[8], sizeof(command2[8]));
        send_command(command2[9], sizeof(command2[9]));
        send_command(command2[10], sizeof(command2[10]));
        send_command(command2[11], sizeof(command2[11]));
        send_command(command2[12], sizeof(command2[12]));
        send_command(command2[13], sizeof(command2[13]));
        send_command(command2[14], sizeof(command2[14]));
        send_command(command2[15], sizeof(command2[15]));
    }

    return 0;
}